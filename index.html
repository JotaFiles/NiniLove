<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Nini ❤️ Jota - Nuestro Amor</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&family=Playfair+Display:wght@400;500;600;700&display=swap');
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary-pink: #ff6b9d;
            --secondary-pink: #ffc1cc;
            --accent-blue: #4ecdc4;
            --light-pink: #fff0f3;
            --dark-text: #2d3436;
            --medium-text: #636e72;
            --white: #ffffff;
            --gradient-1: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            --gradient-2: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            --gradient-3: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            --shadow-light: 0 4px 20px rgba(255, 107, 157, 0.15);
            --shadow-medium: 0 8px 30px rgba(255, 107, 157, 0.2);
            --shadow-heavy: 0 15px 40px rgba(255, 107, 157, 0.3);
        }

        body {
            font-family: 'Poppins', sans-serif;
            background: linear-gradient(135deg, #ffeef8 0%, #f0f8ff 50%, #fff0f8 100%);
            min-height: 100vh;
            position: relative;
            overflow-x: hidden;
        }

        /* Fondo animado moderno */
        .animated-bg {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: -1;
            overflow: hidden;
        }

        .floating-heart {
            position: absolute;
            animation: float-heart 15s linear infinite;
            opacity: 0;
        }

        @keyframes float-heart {
            0% {
                transform: translateY(100vh) rotate(0deg);
                opacity: 0;
            }
            5% { opacity: 0.6; }
            95% { opacity: 0.6; }
            100% {
                transform: translateY(-20vh) rotate(360deg);
                opacity: 0;
            }
        }

        .geometric-shape {
            position: absolute;
            border-radius: 50%;
            background: linear-gradient(45deg, rgba(255, 107, 157, 0.1), rgba(78, 205, 196, 0.1));
            animation: geometric-float 20s ease-in-out infinite;
        }

        @keyframes geometric-float {
            0%, 100% { 
                transform: translateY(0px) translateX(0px) scale(1);
                opacity: 0.3;
            }
            25% { 
                transform: translateY(-30px) translateX(20px) scale(1.1);
                opacity: 0.5;
            }
            50% { 
                transform: translateY(-60px) translateX(-10px) scale(0.9);
                opacity: 0.4;
            }
            75% { 
                transform: translateY(-30px) translateX(-20px) scale(1.2);
                opacity: 0.6;
            }
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 15px;
        }

        /* Header moderno */
        .header {
            text-align: center;
            margin-bottom: 30px;
            position: relative;
        }

        .header-content {
            background: rgba(255, 255, 255, 0.8);
            backdrop-filter: blur(20px);
            border-radius: 25px;
            padding: 25px;
            box-shadow: var(--shadow-light);
            border: 1px solid rgba(255, 255, 255, 0.3);
        }

        .header h1 {
            font-family: 'Playfair Display', serif;
            font-size: 2.8rem;
            background: var(--gradient-2);
            background-clip: text;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 10px;
            font-weight: 700;
        }

        .header p {
            color: var(--medium-text);
            font-size: 1.1rem;
            font-weight: 400;
            margin-bottom: 20px;
        }

        .header-icons {
            display: flex;
            justify-content: center;
            gap: 20px;
            font-size: 2rem;
        }

        .icon-bounce {
            animation: gentle-bounce 2s ease-in-out infinite;
        }

        @keyframes gentle-bounce {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-5px); }
        }

        /* Cards modernas */
        .card {
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(20px);
            border-radius: 20px;
            padding: 20px;
            margin-bottom: 25px;
            box-shadow: var(--shadow-light);
            border: 1px solid rgba(255, 255, 255, 0.3);
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .card:hover {
            transform: translateY(-3px);
            box-shadow: var(--shadow-medium);
        }

        .card::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
            transition: left 0.5s ease;
        }

        .card:hover::before {
            left: 100%;
        }

        /* Clock moderno */
        .clock-section {
            text-align: center;
            position: relative;
            z-index: 1;
        }

        .clock-display {
            background: plum;
            color: white;
            padding: 15px;
            border-radius: 20px;
            margin-bottom: 20px;
            box-shadow: plum;
        }

        .clock {
            font-size: 2rem;
            font-weight: 600;
            margin-bottom: 5px;
            font-family: 'Poppins', sans-serif;
        }

        .date {
            font-size: 0.9rem;
            opacity: 0.9;
            font-weight: 400;
        }

        .love-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 12px;
            margin-top: 20px;
        }

        .stat-item {
            background: rgba(255, 107, 157, 0.1);
            padding: 12px;
            border-radius: 12px;
            text-align: center;
            border-left: 4px solid var(--primary-pink);
        }

        .stat-number {
            font-size: 1.3rem;
            font-weight: 600;
            color: var(--primary-pink);
            display: block;
        }

        .stat-label {
            font-size: 0.8rem;
            color: var(--medium-text);
            margin-top: 5px;
        }

        /* Calendario moderno - MEJORADO PARA MÓVILES */
        .calendar-section h2 {
            font-family: 'Playfair Display', serif;
            color: var(--primary-pink);
            font-size: 1.8rem;
            margin-bottom: 20px;
            text-align: center;
            position: relative;
            z-index: 1;
        }

        .turn-indicator {
            text-align: center;
            margin-bottom: 20px;
            padding: 12px;
            border-radius: 15px;
            font-weight: 500;
            font-size: 0.9rem;
            position: relative;
            z-index: 1;
            background: rgba(78, 205, 196, 0.1);
            border: 2px solid var(--accent-blue);
            color: var(--accent-blue);
        }

        .calendar-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            position: relative;
            z-index: 1;
        }

        .calendar-nav {
            background: var(--gradient-2);
            border: none;
            color: white;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 1.1rem;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: var(--shadow-light);
            flex-shrink: 0;
        }

        .calendar-nav:hover {
            transform: scale(1.1);
            box-shadow: var(--shadow-medium);
        }

        .calendar-month {
            font-family: 'Playfair Display', serif;
            font-size: 1.4rem;
            color: var(--primary-pink);
            font-weight: 600;
            text-align: center;
            flex: 1;
            margin: 0 10px;
        }

        .calendar-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 3px;
            position: relative;
            z-index: 1;
            width: 100%;
            max-width: 100%;
            overflow: hidden;
        }

        .calendar-day-header {
            text-align: center;
            font-weight: 600;
            color: var(--medium-text);
            padding: 8px 4px;
            font-size: 0.75rem;
            background: rgba(255, 107, 157, 0.1);
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            min-height: 30px;
        }

        .calendar-day {
            aspect-ratio: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            font-weight: 500;
            font-size: 0.85rem;
            background: rgba(255, 255, 255, 0.5);
            border: 2px solid transparent;
            min-height: 35px;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .calendar-day.today {
            background: var(--gradient-2);
            color: white;
            font-weight: 600;
            box-shadow: var(--shadow-medium);
        }

        .calendar-day.past {
            background: rgba(255, 107, 157, 0.1);
            color: var(--primary-pink);
        }

        .calendar-day.future {
            background: rgba(200, 200, 200, 0.1);
            color: #ccc;
            cursor: not-allowed;
        }

        .calendar-day.nini-turn {
            border-color: var(--primary-pink);
            background: rgba(255, 107, 157, 0.1);
        }

        .calendar-day.jota-turn {
            border-color: var(--accent-blue);
            background: rgba(78, 205, 196, 0.1);
        }

        .calendar-day.has-entry::after {
            content: '💝';
            position: absolute;
            top: 1px;
            right: 1px;
            font-size: 0.6rem;
        }

        .calendar-day:hover:not(.future) {
            transform: scale(1.05);
            box-shadow: var(--shadow-light);
        }

        /* Modal moderno */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            backdrop-filter: blur(10px);
            padding: 15px;
        }

        .modal-content {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            border-radius: 20px;
            padding: 25px;
            width: calc(100% - 30px);
            max-width: 450px;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: var(--shadow-heavy);
            border: 1px solid rgba(255, 255, 255, 0.3);
        }

        .modal h3 {
            color: var(--primary-pink);
            margin-bottom: 15px;
            font-family: 'Playfair Display', serif;
            font-size: 1.5rem;
            text-align: center;
        }

        /* Formularios modernos */
        .form-group {
            margin-bottom: 15px;
        }

        .form-input, .form-select, .form-textarea {
            width: 100%;
            padding: 12px;
            border: none;
            border-radius: 12px;
            background: rgba(255, 107, 157, 0.05);
            border: 2px solid rgba(255, 107, 157, 0.1);
            font-family: 'Poppins', sans-serif;
            font-size: 0.95rem;
            color: var(--dark-text);
            transition: all 0.3s ease;
        }

        .form-input:focus, .form-select:focus, .form-textarea:focus {
            outline: none;
            border-color: var(--primary-pink);
            background: rgba(255, 107, 157, 0.1);
            transform: translateY(-1px);
            box-shadow: var(--shadow-light);
        }

        .form-textarea {
            resize: vertical;
            min-height: 80px;
        }

        .file-upload {
            position: relative;
            display: inline-block;
            width: 100%;
        }

        .file-upload input[type="file"] {
            display: none;
        }

        .file-upload-btn {
            display: block;
            width: 100%;
            padding: 12px;
            background: var(--gradient-3);
            color: white;
            text-align: center;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 500;
            box-shadow: var(--shadow-light);
            font-size: 0.9rem;
        }

        .file-upload-btn:hover {
            transform: translateY(-1px);
            box-shadow: var(--shadow-medium);
        }

        /* Botones modernos */
        .btn {
            padding: 12px 20px;
            border: none;
            border-radius: 20px;
            background: var(--gradient-2);
            color: white;
            cursor: pointer;
            font-weight: 600;
            font-family: 'Poppins', sans-serif;
            transition: all 0.3s ease;
            box-shadow: var(--shadow-light);
            font-size: 0.9rem;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 6px;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-medium);
        }

        .btn-secondary {
            background: linear-gradient(135deg, #74b9ff, #0984e3);
        }

        .btn-group {
            display: flex;
            gap: 10px;
            justify-content: center;
            flex-wrap: wrap;
        }

        /* Secciones de contenido */
        .section-title {
            font-family: 'Playfair Display', serif;
            color: var(--primary-pink);
            font-size: 1.8rem;
            margin-bottom: 20px;
            text-align: center;
            position: relative;
        }

        .content-grid {
            display: grid;
            gap: 15px;
        }

        .content-item {
            background: rgba(255, 255, 255, 0.7);
            padding: 15px;
            border-radius: 15px;
            border-left: 4px solid var(--primary-pink);
            box-shadow: var(--shadow-light);
            transition: all 0.3s ease;
        }

        .content-item:hover {
            transform: translateX(3px);
            box-shadow: var(--shadow-medium);
        }

        .content-meta {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
            flex-wrap: wrap;
            gap: 8px;
        }

        .content-author {
            font-weight: 600;
            color: var(--primary-pink);
            font-size: 0.9rem;
        }

        .content-time {
            font-size: 0.75rem;
            color: var(--medium-text);
            background: rgba(255, 107, 157, 0.1);
            padding: 4px 8px;
            border-radius: 8px;
        }

        .content-text {
            color: var(--dark-text);
            line-height: 1.5;
            font-style: italic;
            font-size: 0.9rem;
        }

        .memory-image {
            width: 100%;
            max-height: 250px;
            object-fit: cover;
            border-radius: 12px;
            margin-bottom: 12px;
            box-shadow: var(--shadow-light);
        }

        /* Estados de carga y error */
        .loading {
            text-align: center;
            color: var(--primary-pink);
            font-style: italic;
            padding: 30px 15px;
            font-size: 0.9rem;
        }

        .error {
            background: rgba(255, 87, 87, 0.1);
            color: #d63031;
            padding: 12px;
            border-radius: 12px;
            border-left: 4px solid #d63031;
            margin-bottom: 15px;
            font-size: 0.9rem;
        }

        .success {
            background: rgba(0, 184, 148, 0.1);
            color: #00b894;
            padding: 12px;
            border-radius: 12px;
            border-left: 4px solid #00b894;
            margin-bottom: 15px;
            font-size: 0.9rem;
        }

        .empty-state {
            text-align: center;
            color: var(--medium-text);
            font-style: italic;
            padding: 30px 15px;
            background: rgba(255, 107, 157, 0.05);
            border-radius: 15px;
            border: 2px dashed rgba(255, 107, 157, 0.2);
            font-size: 0.9rem;
        }

        /* Responsive mejorado */
        @media (max-width: 768px) {
            .container {
                padding: 10px;
            }
            
            .header h1 {
                font-size: 2.2rem;
            }
            
            .header-content {
                padding: 20px 15px;
            }
            
            .card {
                padding: 15px;
                margin-bottom: 20px;
                border-radius: 15px;
            }
            
            .clock {
                font-size: 1.8rem;
            }
            
            .love-stats {
                grid-template-columns: repeat(3, 1fr);
                gap: 8px;
            }
            
            .stat-item {
                padding: 10px 8px;
            }
            
            .stat-number {
                font-size: 1.1rem;
            }
            
            .stat-label {
                font-size: 0.7rem;
            }
            
            .calendar-grid {
                gap: 2px;
            }
            
            .calendar-day {
                font-size: 0.75rem;
                min-height: 32px;
                border-radius: 8px;
            }
            
            .calendar-day-header {
                font-size: 0.7rem;
                padding: 6px 2px;
                min-height: 28px;
            }
            
            .calendar-month {
                font-size: 1.2rem;
                margin: 0 8px;
            }
            
            .calendar-nav {
                width: 35px;
                height: 35px;
                font-size: 1rem;
            }
            
            .modal-content {
                width: calc(100% - 20px);
                padding: 20px 15px;
                max-height: 85vh;
            }
            
            .modal h3 {
                font-size: 1.3rem;
            }
            
            .btn-group {
                flex-direction: column;
                gap: 8px;
            }
            
            .btn {
                width: 100%;
                justify-content: center;
                padding: 10px 15px;
                font-size: 0.85rem;
            }
            
            .section-title {
                font-size: 1.5rem;
            }
            
            .content-meta {
                flex-direction: column;
                align-items: flex-start;
                gap: 5px;
            }
            
            .memory-image {
                max-height: 200px;
            }
        }

        /* Responsive extra pequeño */
        @media (max-width: 480px) {
            .container {
                padding: 8px;
            }
            
            .header h1 {
                font-size: 1.9rem;
            }
            
            .calendar-day {
                font-size: 0.7rem;
                min-height: 30px;
            }
            
            .calendar-day-header {
                font-size: 0.65rem;
                min-height: 26px;
            }
            
            .calendar-month {
                font-size: 1.1rem;
            }
            
            .love-stats {
                grid-template-columns: 1fr;
                gap: 8px;
            }
            
            .stat-item {
                display: flex;
                justify-content: space-between;
                align-items: center;
                text-align: left;
            }
            
            .modal-content {
                width: calc(100% - 16px);
            }
        }

        /* Animaciones de entrada */
        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .fade-in {
            animation: fadeInUp 0.6s ease forwards;
        }

        .fade-in:nth-child(2) { animation-delay: 0.1s; }
        .fade-in:nth-child(3) { animation-delay: 0.2s; }
        .fade-in:nth-child(4) { animation-delay: 0.3s; }

        /* Ajustes adicionales para asegurar que no se corte nada */
        @media (max-width: 360px) {
            .calendar-day {
                font-size: 0.65rem;
                min-height: 28px;
            }
            
            .calendar-day-header {
                font-size: 0.6rem;
                min-height: 24px;
                padding: 4px 2px;
            }
        }
    </style>
</head>
<body>
    <div class="animated-bg" id="animatedBg"></div>
    
    <div class="container">
        <header class="header fade-in">
            <div class="header-content">
                   <img src="https://i.gifer.com/origin/36/36bcb36e9832e37c993063a41da0fbc4_w200.gif" alt="Descripción" width="100" height="150">
                <h1>Nini & Jota</h1>
                <p>Nuestro espacio de amor uwu</p>
                <div class="header-icons">
                   
                 
                </div>
            </div>
        </header>

        <!-- Sección del reloj -->
        <div class="card fade-in">
            <div class="clock-section">
                <div class="clock-display">
                    <img src="https://i.gifer.com/7V0.gif" alt="Descripción" width="200" height="200">
                    <div class="clock" id="clock">00:00:00</div>
                    

                    <div class="date" id="date">Cargando fecha...</div>
                </div>
                
                <div class="love-stats">
                    <div class="stat-item">
                        <span class="stat-number" id="daysTogether">0</span>
                        <span class="stat-label">Días juntos</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-number" id="totalMemories">0</span>
                        <span class="stat-label">Recuerdos</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-number" id="totalPhrases">0</span>
                        <span class="stat-label">Frases de amor</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Sección del calendario -->
        <div class="card fade-in">
            <h2 class="section-title">📅 Nuestro Calendario de Amor</h2>
            
            <div id="turnIndicator" class="turn-indicator">
                <div>🎯 Turno actual: <span id="currentTurn">Calculando...</span></div>
            </div>
            
            <div class="calendar-header">
                <button class="calendar-nav" id="prevMonth" onclick="changeMonth(-1)">‹</button>
                <div class="calendar-month" id="currentMonth">Enero 2025</div>
                <button class="calendar-nav" id="nextMonth" onclick="changeMonth(1)">›</button>
            </div>
            
            <div class="calendar-grid" id="calendar">
                <!-- Calendario se genera dinámicamente -->
            </div>
        </div>

        <!-- Sección de frases -->
        <div class="card fade-in">
            <h2 class="section-title">💭 Frases de Amor</h2>
            
            <div class="form-group">
                <select class="form-select" id="phraseAuthor">
                    <option value="Nini">💖 Nini</option>
                    <option value="Jota">💙 Jota</option>
                </select>
            </div>
            
            <div class="form-group">
                <input type="text" class="form-input" id="phraseText" 
                       placeholder="Escribe una frase bonita para tu amor..." maxlength="200">
            </div>
            
            <button class="btn" onclick="addPhrase()">
                ✨ Agregar Frase
            </button>
            
            <div class="content-grid" id="phrasesList" style="margin-top: 25px;">
                <div class="loading">Cargando frases de amor... 💕</div>
            </div>
        </div>

        <!-- Sección de recuerdos -->
        <div class="card fade-in">
            <h2 class="section-title">📸 Galería de Recuerdos</h2>
            
            <div class="form-group">
                <input type="text" class="form-input" id="memoryTitle" 
                       placeholder="Título del recuerdo..." maxlength="100">
            </div>
            
            <div class="form-group">
                <select class="form-select" id="memoryAuthor">
                    <option value="Nini">💖 Nini</option>
                    <option value="Jota">💙 Jota</option>
                </select>
            </div>
            
            <div class="form-group">
                <div class="file-upload">
                    <input type="file" id="memoryImage" accept="image/*">
                    <label for="memoryImage" class="file-upload-btn">
                        📷 Subir Imagen
                    </label>
                </div>
            </div>
            
            <button class="btn" onclick="addMemory()">
                ✨ Guardar Recuerdo
            </button>
            
            <div class="content-grid" id="memoriesGrid" style="margin-top: 25px;">
                <div class="loading">Cargando recuerdos... 💕</div>
            </div>
        </div>
    </div>

    <!-- Modal del calendario -->
    <div class="modal" id="calendarModal">
        <div class="modal-content">
            <h3 id="modalDate">Fecha seleccionada</h3>
            <div id="modalContent">
                <!-- Contenido dinámico -->
            </div>
        </div>
    </div>

    <script>
        // ===== CONFIGURACIÓN DE SUPABASE =====
        // IMPORTANTE: Reemplaza con tus credenciales de Supabase
        const SUPABASE_URL = 'https://vcnpdfobafoixqhvtymg.supabase.co';
        const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InZjbnBkZm9iYWZvaXhxaHZ0eW1nIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTMwNzE4NDMsImV4cCI6MjA2ODY0Nzg0M30.-pM3Fx5EWdSUZs3lT3xBrKak4JzX0N0DleV6OU74fVM';

        let supabaseClient;
        let isSupabaseConfigured = false;

        // Inicializar Supabase solo si las credenciales están configuradas
        if (SUPABASE_URL !== 'TU_SUPABASE_URL_AQUI' && SUPABASE_ANON_KEY !== 'TU_SUPABASE_ANON_KEY_AQUI') {
            try {
                // CORRECCIÓN: Usar window.supabase en lugar de supabase
                supabaseClient = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
                isSupabaseConfigured = true;
                console.log('✅ Supabase configurado correctamente');
            } catch (error) {
                console.error('Error configurando Supabase:', error);
                isSupabaseConfigured = false;
            }
        } else {
            console.warn('⚠️ Supabase no está configurado. Usando almacenamiento local.');
        }

        // ===== VARIABLES GLOBALES =====
        let currentDate = new Date();
        let currentMonth = new Date().getMonth();
        let currentYear = new Date().getFullYear();
        let calendarEntries = {};
        let phrases = [];
        let memories = [];

        // Fecha de inicio de la relación (puedes cambiarla)
        const relationshipStart = new Date('2024-10-20'); // Cambia esta fecha

        // ===== INICIALIZACIÓN =====
        document.addEventListener('DOMContentLoaded', async function() {
            createAnimatedBackground();
            updateClock();
            await loadAllData();
            generateCalendar();
            updateTurnIndicator();
            updateStats();
            
            setInterval(updateClock, 1000);
            setInterval(createFloatingHeart, 5000);
            
            // Cerrar modal al hacer clic fuera
            document.getElementById('calendarModal').addEventListener('click', function(e) {
                if (e.target === this) {
                    closeModal();
                }
            });

            // Agregar animaciones de entrada
            const cards = document.querySelectorAll('.card');
            cards.forEach((card, index) => {
                setTimeout(() => {
                    card.classList.add('fade-in');
                }, index * 200);
            });
        });

        // ===== FUNCIONES DE SUPABASE =====
        async function initializeDatabase() {
            if (!isSupabaseConfigured) return;

            try {
                // Crear tablas si no existen
                const { error: phrasesError } = await supabaseClient.rpc('create_phrases_table');
                const { error: memoriesError } = await supabaseClient.rpc('create_memories_table');
                const { error: calendarError } = await supabaseClient.rpc('create_calendar_entries_table');
                
                if (phrasesError || memoriesError || calendarError) {
                    console.log('Las tablas ya existen o se crearon correctamente');
                }
            } catch (error) {
                console.error('Error inicializando base de datos:', error);
            }
        }

        async function loadAllData() {
            await loadPhrases();
            await loadMemories();
            await loadCalendarEntries();
        }

        // ===== FUNCIONES DE CARGA DE DATOS =====
        async function loadPhrases() {
            if (isSupabaseConfigured) {
                try {
                    const { data, error } = await supabaseClient
                        .from('phrases')
                        .select('*')
                        .order('created_at', { ascending: false });
                    
                    if (error) throw error;
                    phrases = data || [];
                } catch (error) {
                    console.error('Error cargando frases:', error);
                    phrases = JSON.parse(localStorage.getItem('phrases') || '[]');
                }
            } else {
                phrases = JSON.parse(localStorage.getItem('phrases') || '[]');
            }
            displayPhrases();
        }

        async function loadMemories() {
            if (isSupabaseConfigured) {
                try {
                    const { data, error } = await supabaseClient
                        .from('memories')
                        .select('*')
                        .order('created_at', { ascending: false });
                    
                    if (error) throw error;
                    memories = data || [];
                } catch (error) {
                    console.error('Error cargando recuerdos:', error);
                    memories = JSON.parse(localStorage.getItem('memories') || '[]');
                }
            } else {
                memories = JSON.parse(localStorage.getItem('memories') || '[]');
            }
            displayMemories();
        }

        async function loadCalendarEntries() {
            if (isSupabaseConfigured) {
                try {
                    const { data, error } = await supabaseClient
                        .from('calendar_entries')
                        .select('*');
                    
                    if (error) throw error;
                    
                    calendarEntries = {};
                    data?.forEach(entry => {
                        calendarEntries[entry.date] = entry;
                    });
                } catch (error) {
                    console.error('Error cargando entradas del calendario:', error);
                    calendarEntries = JSON.parse(localStorage.getItem('calendarEntries') || '{}');
                }
            } else {
                calendarEntries = JSON.parse(localStorage.getItem('calendarEntries') || '{}');
            }
        }

        // ===== FUNCIONES DE GUARDADO =====
        async function savePhrase(phrase) {
            if (isSupabaseConfigured) {
                try {
                    const { data, error } = await supabaseClient
                        .from('phrases')
                        .insert([phrase])
                        .select();
                    
                    if (error) throw error;
                    return data[0];
                } catch (error) {
                    console.error('Error guardando frase:', error);
                    // Fallback a localStorage
                    phrases.unshift(phrase);
                    localStorage.setItem('phrases', JSON.stringify(phrases));
                    return phrase;
                }
            } else {
                phrases.unshift(phrase);
                localStorage.setItem('phrases', JSON.stringify(phrases));
                return phrase;
            }
        }

        async function saveMemory(memory) {
            if (isSupabaseConfigured) {
                try {
                    const { data, error } = await supabaseClient
                        .from('memories')
                        .insert([memory])
                        .select();
                    
                    if (error) throw error;
                    return data[0];
                } catch (error) {
                    console.error('Error guardando recuerdo:', error);
                    // Fallback a localStorage
                    memories.unshift(memory);
                    localStorage.setItem('memories', JSON.stringify(memories));
                    return memory;
                }
            } else {
                memories.unshift(memory);
                localStorage.setItem('memories', JSON.stringify(memories));
                return memory;
            }
        }

        async function saveCalendarEntry(entry) {
            if (isSupabaseConfigured) {
                try {
                    const { data, error } = await supabaseClient
                        .from('calendar_entries')
                        .upsert([entry])
                        .select();
                    
                    if (error) throw error;
                    return data[0];
                } catch (error) {
                    console.error('Error guardando entrada del calendario:', error);
                    // Fallback a localStorage
                    calendarEntries[entry.date] = entry;
                    localStorage.setItem('calendarEntries', JSON.stringify(calendarEntries));
                    return entry;
                }
            } else {
                calendarEntries[entry.date] = entry;
                localStorage.setItem('calendarEntries', JSON.stringify(calendarEntries));
                return entry;
            }
        }

        // ===== FUNCIONES DE RELOJ Y ESTADÍSTICAS =====
        function updateClock() {
            const now = new Date();
            const timeString = now.toLocaleTimeString('es-ES', {
                hour12: false,
                hour: '2-digit',
                minute: '2-digit',
                second: '2-digit'
            });
            
            const dateString = now.toLocaleDateString('es-ES', {
                weekday: 'long',
                year: 'numeric',
                month: 'long',
                day: 'numeric'
            });
            
            document.getElementById('clock').textContent = timeString;
            document.getElementById('date').textContent = dateString;
        }

        function updateStats() {
            const daysTogether = Math.floor((new Date() - relationshipStart) / (1000 * 60 * 60 * 24));
            document.getElementById('daysTogether').textContent = daysTogether;
            document.getElementById('totalMemories').textContent = memories.length;
            document.getElementById('totalPhrases').textContent = phrases.length;
        }

        // ===== FUNCIONES DEL CALENDARIO =====
        function generateCalendar() {
            const calendar = document.getElementById('calendar');
            const monthNames = [
                'Enero', 'Febrero', 'Marzo', 'Abril', 'Mayo', 'Junio',
                'Julio', 'Agosto', 'Septiembre', 'Octubre', 'Noviembre', 'Diciembre'
            ];
            
            document.getElementById('currentMonth').textContent = `${monthNames[currentMonth]} ${currentYear}`;
            
            const firstDay = new Date(currentYear, currentMonth, 1);
            const lastDay = new Date(currentYear, currentMonth + 1, 0);
            const startDate = new Date(firstDay);
            startDate.setDate(startDate.getDate() - firstDay.getDay());
            
            calendar.innerHTML = '';
            
            // Headers de días
            const dayHeaders = ['Dom', 'Lun', 'Mar', 'Mié', 'Jue', 'Vie', 'Sáb'];
            dayHeaders.forEach(day => {
                const header = document.createElement('div');
                header.className = 'calendar-day-header';
                header.textContent = day;
                calendar.appendChild(header);
            });
            
            // Días del calendario
            for (let i = 0; i < 42; i++) {
                const cellDate = new Date(startDate);
                cellDate.setDate(startDate.getDate() + i);
                
                const dayElement = document.createElement('div');
                dayElement.className = 'calendar-day';
                dayElement.textContent = cellDate.getDate();
                
                const dateString = cellDate.toISOString().split('T')[0];
                const today = new Date().toISOString().split('T')[0];
                
                // Clases de estado
                if (dateString === today) {
                    dayElement.classList.add('today');
                } else if (cellDate < new Date()) {
                    dayElement.classList.add('past');
                } else {
                    dayElement.classList.add('future');
                }
                
                // Determinar turno
                const daysSinceStart = Math.floor((cellDate - relationshipStart) / (1000 * 60 * 60 * 24));
                if (daysSinceStart >= 0) {
                    if (daysSinceStart % 2 === 0) {
                        dayElement.classList.add('nini-turn');
                    } else {
                        dayElement.classList.add('jota-turn');
                    }
                }
                
                // Verificar si hay entrada
                if (calendarEntries[dateString]) {
                    dayElement.classList.add('has-entry');
                }
                
                // Event listener
                dayElement.addEventListener('click', () => openCalendarModal(dateString));
                
                calendar.appendChild(dayElement);
            }
        }

        function changeMonth(direction) {
            currentMonth += direction;
            if (currentMonth > 11) {
                currentMonth = 0;
                currentYear++;
            } else if (currentMonth < 0) {
                currentMonth = 11;
                currentYear--;
            }
            generateCalendar();
        }

        function updateTurnIndicator() {
            const today = new Date();
            const daysSinceStart = Math.floor((today - relationshipStart) / (1000 * 60 * 60 * 24));
            const currentTurnElement = document.getElementById('currentTurn');
            
            if (daysSinceStart >= 0) {
                if (daysSinceStart % 2 === 0) {
                    currentTurnElement.innerHTML = '💖 <strong>Nini</strong>';
                    currentTurnElement.style.color = 'var(--primary-pink)';
                } else {
                    currentTurnElement.innerHTML = '💙 <strong>Jota</strong>';
                    currentTurnElement.style.color = 'var(--accent-blue)';
                }
            } else {
                currentTurnElement.textContent = 'Aún no han empezado';
            }
        }

        // ===== FUNCIONES DEL MODAL =====
        function openCalendarModal(dateString) {
            const modal = document.getElementById('calendarModal');
            const modalDate = document.getElementById('modalDate');
            const modalContent = document.getElementById('modalContent');
            
            const date = new Date(dateString + 'T12:00:00');
            const formattedDate = date.toLocaleDateString('es-ES', {
                weekday: 'long',
                year: 'numeric',
                month: 'long',
                day: 'numeric'
            });
            
            modalDate.textContent = formattedDate;
            
            const daysSinceStart = Math.floor((date - relationshipStart) / (1000 * 60 * 60 * 24));
            let whosTurn = '';
            
            if (daysSinceStart >= 0) {
                whosTurn = daysSinceStart % 2 === 0 ? '💖 Nini' : '💙 Jota';
            }
            
            const entry = calendarEntries[dateString];
            
            modalContent.innerHTML = `
                <div style="margin-bottom: 20px;">
                    <strong>Turno del día:</strong> ${whosTurn}
                </div>
                
                ${entry ? `
                    <div class="content-item" style="margin-bottom: 20px;">
                        <div class="content-meta">
                            <span class="content-author">${entry.author}</span>
                            <span class="content-time">${entry.type}</span>
                        </div>
                        <div class="content-text">${entry.content}</div>
                        ${entry.image ? `<img src="${entry.image}" class="memory-image" alt="Recuerdo">` : ''}
                    </div>
                ` : `
                    <div class="empty-state">
                        No hay ninguna entrada para este día ✨
                    </div>
                `}
                
                <div class="btn-group" style="margin-top: 20px;">
                    ${!entry ? `
                        <button class="btn" onclick="addCalendarEntry('${dateString}', 'note')">
                            📝 Agregar Nota
                        </button>
                        <button class="btn btn-secondary" onclick="addCalendarEntry('${dateString}', 'memory')">
                            📸 Agregar Recuerdo
                        </button>
                    ` : `
                        <button class="btn btn-secondary" onclick="editCalendarEntry('${dateString}')">
                            ✏️ Editar
                        </button>
                        <button class="btn" onclick="deleteCalendarEntry('${dateString}')" 
                                style="background: linear-gradient(135deg, #ff7675, #d63031);">
                            🗑️ Eliminar
                        </button>
                    `}
                    <button class="btn btn-secondary" onclick="closeModal()">
                        ❌ Cerrar
                    </button>
                </div>
            `;
            
            modal.style.display = 'block';
        }

        function closeModal() {
            document.getElementById('calendarModal').style.display = 'none';
        }

        async function addCalendarEntry(dateString, type) {
            const content = prompt(`Escribe tu ${type === 'note' ? 'nota' : 'recuerdo'}:`);
            if (!content) return;
            
            const author = prompt('¿Quién escribe? (Nini/Jota):', 'Nini');
            if (!author) return;
            
            const entry = {
                date: dateString,
                author: author,
                type: type === 'note' ? '📝 Nota' : '📸 Recuerdo',
                content: content,
                created_at: new Date().toISOString()
            };
            
            if (type === 'memory') {
                const imageInput = document.createElement('input');
                imageInput.type = 'file';
                imageInput.accept = 'image/*';
                imageInput.onchange = async function(e) {
                    const file = e.target.files[0];
                    if (file) {
                        entry.image = await fileToBase64(file);
                    }
                    await saveCalendarEntry(entry);
                    generateCalendar();
                    closeModal();
                };
                imageInput.click();
            } else {
                await saveCalendarEntry(entry);
                generateCalendar();
                closeModal();
            }
        }

        async function deleteCalendarEntry(dateString) {
            if (!confirm('¿Estás seguro de que quieres eliminar esta entrada?')) return;
            
            if (isSupabaseConfigured) {
                try {
                    const { error } = await supabaseClient
                        .from('calendar_entries')
                        .delete()
                        .eq('date', dateString);
                    
                    if (error) throw error;
                } catch (error) {
                    console.error('Error eliminando entrada:', error);
                }
            }
            
            delete calendarEntries[dateString];
            localStorage.setItem('calendarEntries', JSON.stringify(calendarEntries));
            
            generateCalendar();
            closeModal();
        }

        // ===== FUNCIONES DE FRASES =====
        async function addPhrase() {
            const text = document.getElementById('phraseText').value.trim();
            const author = document.getElementById('phraseAuthor').value;
            
            if (!text) {
                alert('Por favor, escribe una frase bonita 💕');
                return;
            }
            
            const phrase = {
                id: Date.now(),
                author: author,
                text: text,
                created_at: new Date().toISOString()
            };
            
            await savePhrase(phrase);
            phrases.unshift(phrase);
            
            document.getElementById('phraseText').value = '';
            displayPhrases();
            updateStats();
            
            // Mostrar mensaje de éxito
            showMessage('✨ Frase agregada con amor', 'success');
        }

        function displayPhrases() {
            const container = document.getElementById('phrasesList');
            
            if (phrases.length === 0) {
                container.innerHTML = '<div class="empty-state">Aún no hay frases de amor. ¡Sé el primero en escribir una! 💕</div>';
                return;
            }
            
            container.innerHTML = phrases.map(phrase => `
                <div class="content-item">
                    <div class="content-meta">
                        <span class="content-author">${phrase.author}</span>
                        <span class="content-time">${formatDate(phrase.created_at)}</span>
                    </div>
                    <div class="content-text">"${phrase.text}"</div>
                </div>
            `).join('');
        }

        // ===== FUNCIONES DE RECUERDOS =====
        async function addMemory() {
            const title = document.getElementById('memoryTitle').value.trim();
            const author = document.getElementById('memoryAuthor').value;
            const imageFile = document.getElementById('memoryImage').files[0];
            
            if (!title) {
                alert('Por favor, escribe un título para el recuerdo 💕');
                return;
            }
            
            if (!imageFile) {
                alert('Por favor, selecciona una imagen 📸');
                return;
            }
            
            const imageBase64 = await fileToBase64(imageFile);
            
            const memory = {
                id: Date.now(),
                title: title,
                author: author,
                image: imageBase64,
                created_at: new Date().toISOString()
            };
            
            await saveMemory(memory);
            memories.unshift(memory);
            
            document.getElementById('memoryTitle').value = '';
            document.getElementById('memoryImage').value = '';
            displayMemories();
            updateStats();
            
            // Mostrar mensaje de éxito
            showMessage('📸 Recuerdo guardado con amor', 'success');
        }

        function displayMemories() {
            const container = document.getElementById('memoriesGrid');
            
            if (memories.length === 0) {
                container.innerHTML = '<div class="empty-state">Aún no hay recuerdos. ¡Sube tu primera foto! 📸</div>';
                return;
            }
            
            container.innerHTML = memories.map(memory => `
                <div class="content-item">
                    <img src="${memory.image}" class="memory-image" alt="${memory.title}">
                    <div class="content-meta">
                        <span class="content-author">${memory.author}</span>
                        <span class="content-time">${formatDate(memory.created_at)}</span>
                    </div>
                    <div class="content-text"><strong>${memory.title}</strong></div>
                </div>
            `).join('');
        }

        // ===== FUNCIONES AUXILIARES =====
        function fileToBase64(file) {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.readAsDataURL(file);
                reader.onload = () => resolve(reader.result);
                reader.onerror = error => reject(error);
            });
        }

        function formatDate(dateString) {
            const date = new Date(dateString);
            return date.toLocaleDateString('es-ES', {
                year: 'numeric',
                month: 'short',
                day: 'numeric',
                hour: '2-digit',
                minute: '2-digit'
            });
        }

        function showMessage(message, type) {
            const messageDiv = document.createElement('div');
            messageDiv.className = type;
            messageDiv.textContent = message;
            messageDiv.style.position = 'fixed';
            messageDiv.style.top = '20px';
            messageDiv.style.right = '20px';
            messageDiv.style.zIndex = '10000';
            messageDiv.style.padding = '15px 20px';
            messageDiv.style.borderRadius = '15px';
            messageDiv.style.fontWeight = '500';
            
            document.body.appendChild(messageDiv);
            
            setTimeout(() => {
                messageDiv.remove();
            }, 3000);
        }

        // ===== FUNCIONES DE ANIMACIÓN =====
        function createAnimatedBackground() {
            const bg = document.getElementById('animatedBg');
            
            // Crear formas geométricas
            for (let i = 0; i < 8; i++) {
                const shape = document.createElement('div');
                shape.className = 'geometric-shape';
                shape.style.width = Math.random() * 100 + 50 + 'px';
                shape.style.height = shape.style.width;
                shape.style.left = Math.random() * 100 + '%';
                shape.style.top = Math.random() * 100 + '%';
                shape.style.animationDelay = Math.random() * 20 + 's';
                bg.appendChild(shape);
            }
        }

        function createFloatingHeart() {
            const heart = document.createElement('div');
            heart.className = 'floating-heart';
            heart.innerHTML = ['💕', '💖', '💗', '💝', '💘'][Math.floor(Math.random() * 5)];
            heart.style.left = Math.random() * 100 + '%';
            heart.style.fontSize = Math.random() * 20 + 15 + 'px';
            heart.style.animationDuration = (Math.random() * 10 + 10) + 's';
            
            document.getElementById('animatedBg').appendChild(heart);
            
            setTimeout(() => {
                heart.remove();
            }, 15000);
        }

        // ===== EVENT LISTENERS ADICIONALES =====
        document.getElementById('phraseText').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                addPhrase();
            }
        });

        document.getElementById('memoryTitle').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                addMemory();
            }
        });

        // Inicializar la base de datos al cargar
        initializeDatabase();
    </script>
</body>
</html>
